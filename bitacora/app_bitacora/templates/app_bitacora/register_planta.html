<!DOCTYPE html>
<html lang="es">
  <head>
    {% load static %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Etapas del Cultivo - Bitácora</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background-color: #f8f9fa;
        padding: 40px;
      }

      h1 {
        color: #2a4d24;
        margin-bottom: 30px;
        text-align: center;
      }

      .card-etapa {
        margin-bottom: 15px;
        border-left: 6px solid #3c8045;
      }

      .btn-primary {
        background-color: #3c8045;
        border: none;
      }

      .btn-primary:hover {
        background-color: #2f6136;
      }

      .back-arrow {
        position: absolute;
        top: 25px;
        left: 25px;
        color: #3c8045;
        text-decoration: none;
      }

      .semillin {
        position: fixed;
        bottom: 20px;
        right: 40px;
        width: 120px;
        height: auto;
      }
      .not-found{
        width: 100%;
      }
    </style>
  </head>

  <body>
    <a href="{% url 'menu' %}" class="back-arrow" title="Volver al inicio">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="30"
        height="30"
        fill="currentColor"
        class="bi bi-arrow-left-square-fill"
        viewBox="0 0 16 16"
      >
        <path
          d="M16 14a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2zm-4.5-6.5H5.707l2.147-2.146a.5.5 0 1 0-.708-.708l-3 3a.5.5 0 0 0 0 .708l3 3a.5.5 0 0 0 .708-.708L5.707 8.5H11.5a.5.5 0 0 0 0-1"
        />
      </svg>
    </a>

    <div class="container">
      <h1>Registros del Cultivo 🌱</h1>

      <!-- FORMULARIO -->
      <!-- <form method="POST" class="card p-4 shadow-sm mb-4"> -->
      <form
        method="POST"
        enctype="multipart/form-data"
        class="card p-4 shadow-sm mb-4"
      >
        {% csrf_token %}
        <div class="row g-3">
          <!-- Selección de Planta -->
          <div class="col-md-6">
            <label for="id_experimiento" class="form-label"
              >Experimentos</label
            >
            <select
              name="id_experimento"
              id="id_experimento"
              class="form-select"
              required
            >
              <option value="">Selecciona un experimiento</option>
              {% for experimiento in experimientos %}
              <option value="{{ experimiento.id_experimento }}">
                {{ experimiento.nombre }}
              </option>
              {% endfor %}
            </select>
          </div>

          <!-- Altura CM -->
          <div class="col-md-6">
            <label for="altura_cm" class="form-label">Altura cm</label>
            <input
              type="number"
              class="form-control"
              name="altura_cm"
              id="altura_cm"
              min="1"
              required
            />
          </div>

          <!-- Fecha registro -->
          <div class="col-md-6">
            <label for="fecha_registro" class="form-label">Fecha</label>
            <input
              type="date"
              class="form-control"
              name="fecha_registro"
              id="fecha_registro"
              min="1"
              required
            />
          </div>

          <!-- 🖼️ Campo para subir imagen -->
          <div class="col-md-6">
            <label for="imagen" class="form-label">Subir imagen</label>
            <input
              type="file"
              id="imagen"
              name="imagen"
              class="form-control"
              accept="image/*"
            />
          </div>

          <div class="col-12 text-center mt-3">
            <button type="submit" class="btn btn-primary px-4">
              ➕ Registrar Bitacora
            </button>
          </div>
        </div>
      </form>

      <!-- LISTA -->
      <div class="container mt-4">
        <div class="row row-cols-1 row-cols-md-3 g-4">
          {% for registro in registros %}
          <div class="col">
            <div class="card h-100 shadow-sm">
              {% if registro.imagen %}
              <img
                src="{{ registro.imagen.url }}"
                class="card-img-top"
                alt="Imagen de planta"
                style="object-fit: cover; height: 220px"
              />
              {% else %}
              <img
                src="/media/img/not-found.jpg"
                class="card-img-top not-found"
                alt="Sin imagen"
                style="object-fit: cover; height: 220px"
              />
              {% endif %}

              <div class="card-body">
                <h5 class="card-title">
                  {{ registro.id_experimento.nombre }}
                </h5>
                <p class="card-text mb-1">
                  🌿 <strong>Altura:</strong> {{ registro.altura_cm }} cm
                </p>
                <p class="card-text mb-1">
                  📅 <strong>Fecha:</strong> {{ registro.fecha_registro }}
                </p>
              </div>

              <div class="card-footer text-center">
                <form
                  method="POST"
                  action="#"
                  class="d-inline"
                >
                  {% csrf_token %}
                  <button
                    type="submit"
                    class="btn btn-outline-danger btn-sm"
                    onclick="return confirm('¿Seguro que deseas eliminar este registro?')"
                  >
                    Eliminar
                  </button>
                </form>
              </div>
            </div>
          </div>
          {% empty %}
          <p class="text-center mt-3 text-muted">No hay registros aún 🌱</p>
          {% endfor %}
        </div>
      </div>
    </div>

    <img
      src="{% static 'img/semillin_sonriendo_señalando.png' %}"
      class="semillin"
      alt="Semillín saludando"
    />
  </body>
</html>
